# Retrospective - Epic Completion Review Workflow
name: 'retrospective'
description: 'Run after epic completion to review overall success, extract lessons learned, and explore if new information emerged that might impact the next epic'
author: 'BMad'

config_source: '{project-root}/.bmad/bmm/config.yaml'
base_output_folder: '{config_source}:output_folder'
user_name: '{config_source}:user_name'
communication_language: '{config_source}:communication_language'
user_skill_level: '{config_source}:user_skill_level'
document_output_language: '{config_source}:document_output_language'
date: system-generated

# Module isolation variables (Phase 2)
# Inherited from agent session - agents prompt for module selection at startup
manifest_file: '{project-root}/docs/manifest.yaml'
current_category: '' # Inherited from agent session (e.g., "platform")
current_module: '' # Inherited from agent session (e.g., "core-api")

# Module-scoped output paths
output_folder: '{base_output_folder}/{{current_category}}/{{current_module}}'
sprint_artifacts: '{output_folder}/sprint-artifacts'

installed_path: '{project-root}/.bmad/bmm/workflows/4-implementation/retrospective'
template: false
instructions: '{installed_path}/instructions.md'

required_inputs:
  - agent_manifest: '{project-root}/.bmad/_cfg/agent-manifest.csv'

# Smart input file references - handles both whole docs and sharded docs
# Priority: Whole document first, then sharded version
# Strategy: SELECTIVE LOAD - only load the completed epic and relevant retrospectives
input_file_patterns:
  epics:
    description: 'The completed epic for retrospective'
    whole: '{output_folder}/*epic*.md'
    sharded_index: '{output_folder}/*epic*/index.md'
    sharded_single: '{output_folder}/*epic*/epic-{{epic_num}}.md'
    load_strategy: 'SELECTIVE_LOAD'
  previous_retrospective:
    description: "Previous epic's retrospective (optional)"
    pattern: '{sprint_artifacts}/**/epic-{{prev_epic_num}}-retro-*.md'
    load_strategy: 'SELECTIVE_LOAD'
  architecture:
    description: 'System architecture for context'
    whole: '{output_folder}/*architecture*.md'
    sharded: '{output_folder}/*architecture*/*.md'
    load_strategy: 'FULL_LOAD'
  prd:
    description: 'Product requirements for context'
    whole: '{output_folder}/*prd*.md'
    sharded: '{output_folder}/*prd*/*.md'
    load_strategy: 'FULL_LOAD'
  document_project:
    description: 'Brownfield project documentation (optional)'
    sharded: '{output_folder}/*.md'
    load_strategy: 'INDEX_GUIDED'

# Required files
sprint_status_file: '{sprint_artifacts}/sprint-status.yaml || {output_folder}/sprint-status.yaml'
story_directory: '{sprint_artifacts}'
retrospectives_folder: '{sprint_artifacts}'

standalone: true
