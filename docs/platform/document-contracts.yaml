# Document Ownership Contracts
# =============================
#
# This file defines the SINGLE SOURCE OF TRUTH for what each Constitution document OWNS.
#
# GOVERNANCE RULE: Before adding content to any Constitution document, consult this file.
# If the content type is owned by another document, REFERENCE it instead of duplicating.
#
# Version: 1.0
# Created: 2025-12-03
# Status: Active

# =============================================================================
# OWNERSHIP RULES
# =============================================================================
#
# Each content type has ONE and ONLY ONE authoritative source.
# Other documents may:
#   - REFERENCE by ID (e.g., "See PR-001 in prd.md")
#   - SUMMARIZE briefly (1-2 sentences) with link
#   - NEVER copy full definitions, schemas, or interfaces
#
# =============================================================================

contracts:
  # ---------------------------------------------------------------------------
  # PRD (prd.md) - WHAT and WHY
  # ---------------------------------------------------------------------------
  prd:
    purpose: "Business requirements, user value, success criteria"
    owns_exclusively:
      - requirement_definitions:
          pattern: "PR-xxx, IC-xxx"
          description: "Full requirement text, rationale, acceptance criteria"
          canonical_section: "Platform Requirements Index"

      - business_context:
          description: "Why we build, who benefits, problem statement"
          examples:
            - "Executive Summary"
            - "Product Scope"
            - "Success Criteria"
            - "Personalization Principle"

      - user_experience_principles:
          description: "High-level UX philosophy (WHAT users experience)"
          note: "Visual specs live in ux-design.md"

      - subscription_model:
          description: "Pricing tiers, billing philosophy"

      - sla_definitions:
          description: "Response time expectations, availability tiers"

    references_from:
      - architecture: "For HOW technical decisions support requirements"
      - ux-design: "For VISUAL implementation of UX principles"
      - epics: "For COVERAGE mapping of requirements"

    forbidden:
      - typescript_interfaces: "Belongs to architecture.md"
      - visual_specifications: "Belongs to ux-design.md"
      - implementation_details: "Belongs to architecture.md"

  # ---------------------------------------------------------------------------
  # Architecture (architecture.md) - HOW (Technical)
  # ---------------------------------------------------------------------------
  architecture:
    purpose: "Technical decisions, patterns, interfaces, ADRs"
    owns_exclusively:
      - adr_definitions:
          pattern: "ADR-xxx"
          description: "Full ADR text with context, decision, implications"
          canonical_section: "Architecture Decision Records"

      - typescript_interfaces:
          description: "All TypeScript type definitions, schemas, contracts"
          examples:
            - "SystemEvent interface (IC-001 implementation)"
            - "PulseItem interface"
            - "StoryArc interface"
            - "PermissionGrant interface"
          note: "These are the ONLY authoritative TypeScript definitions"

      - technical_patterns:
          description: "Implementation patterns, data flows, service topology"
          examples:
            - "Event envelope schema (ADR-002)"
            - "Tri-State Memory implementation (ADR-006)"
            - "RLS patterns (ADR-003)"
            - "Cross-runtime contracts (ADR-009)"

      - infrastructure:
          description: "Deployment, scaling, observability"

      - api_specifications:
          description: "Endpoint definitions, request/response shapes"

    references_from:
      - prd: "For WHAT requirements the architecture fulfills"
      - epics: "For WHEN features are implemented"

    forbidden:
      - requirement_definitions: "Reference PR-xxx from prd.md"
      - visual_specifications: "Belongs to ux-design.md"
      - business_rationale: "Brief context OK, full rationale in prd.md"

  # ---------------------------------------------------------------------------
  # UX Design (ux-design.md) - HOW (Visual/Interaction)
  # ---------------------------------------------------------------------------
  ux_design:
    purpose: "Visual design, interaction patterns, accessibility"
    owns_exclusively:
      - visual_specifications:
          description: "Colors, typography, spacing, themes"
          examples:
            - "Color palettes (hex values)"
            - "Typography scale"
            - "Spacing system"
            - "Theme definitions"

      - component_specifications:
          description: "UI component behavior, states, variants"
          examples:
            - "Exception Card states"
            - "Toast patterns"
            - "Modal behavior"
            - "Button hierarchy"

      - interaction_patterns:
          description: "How users interact with the system"
          examples:
            - "Chronicle View layout"
            - "Navigation flow"
            - "Copilot widget behavior"

      - accessibility:
          description: "WCAG compliance, screen reader support"

      - responsive_strategy:
          description: "Breakpoints, layout adaptations"

    references_from:
      - prd: "For UX principles and user goals"
      - architecture: "For data structures that inform UI (PulseItem, StoryArc)"

    forbidden:
      - business_requirements: "Reference PR-xxx from prd.md"
      - typescript_interfaces: "Reference from architecture.md"
      - api_definitions: "Reference from architecture.md"

  # ---------------------------------------------------------------------------
  # Epics (epics.md) - WHEN and HOW MUCH
  # ---------------------------------------------------------------------------
  epics:
    purpose: "Work breakdown, traceability, implementation sequence"
    owns_exclusively:
      - epic_definitions:
          description: "Epic goals, stories, acceptance criteria"
          note: "Stories trace TO requirements, don't redefine them"

      - traceability_matrix:
          description: "Which stories cover which requirements"
          note: "References PR-xxx and IC-xxx by ID only"

      - implementation_sequence:
          description: "Order of epics, dependencies between stories"

      - coordination_model:
          description: "Which modules participate in which epic"

    references_from:
      - prd: "For requirement definitions (PR-xxx, IC-xxx)"
      - architecture: "For ADR references in stories"

    forbidden:
      - requirement_definitions: "NEVER repeat PR-xxx text; reference by ID"
      - typescript_interfaces: "Reference ADR from architecture.md"
      - architectural_decisions: "Reference ADR-xxx, don't explain"

  # ---------------------------------------------------------------------------
  # Product Soul (product-soul.md) - WHO WE ARE
  # ---------------------------------------------------------------------------
  product_soul:
    purpose: "Foundational vision, values, brand identity"
    owns_exclusively:
      - vision_statement:
          description: "The 'why' behind Xentri"

      - brand_values:
          description: "Core values, personality traits"

      - pricing_philosophy:
          description: "High-level pricing approach"
          note: "Detailed tiers in prd.md"

      - market_positioning:
          description: "How we differentiate"

    references_from:
      - prd: "For detailed requirements implementing the vision"

    forbidden:
      - detailed_requirements: "Belongs to prd.md"
      - technical_decisions: "Belongs to architecture.md"

# =============================================================================
# CONTENT THAT SPANS DOCUMENTS (Legitimate Overlap)
# =============================================================================
#
# Some concepts legitimately appear in multiple documents with DIFFERENT PURPOSES.
# This is NOT duplication if each document serves its own purpose.
#
# Example: Pulse Hierarchy
#   - prd.md: WHAT it does for users (filtering logic, user value)
#   - architecture.md: HOW it's implemented (data structures, APIs)
#   - ux-design.md: HOW it looks/feels (visual hierarchy, interactions)
#
# Each document adds UNIQUE value. If removing one document's content would
# lose information, it's legitimate. If it's copy-paste, it's duplication.

legitimate_overlap:
  pulse_hierarchy:
    prd: "Business logic, filtering rules, user experience goals"
    architecture: "PulseItem interface, API endpoints, data flow"
    ux_design: "Visual presentation, Chronicle vs Efficiency views"

  story_arcs:
    architecture: "StoryArc interface, arc lifecycle, APIs"
    ux_design: "Visual presentation, progress bars, arc types"

  copilot_widget:
    architecture: "Context resolution, state persistence, APIs"
    ux_design: "Visual states, positioning, interaction modes"

# =============================================================================
# REFERENCE PATTERNS
# =============================================================================
#
# When one document needs to mention content owned by another, use these patterns:

reference_patterns:
  requirement_reference:
    example: |
      > **Traces to:** PR-001, IC-002
      > See [Platform Requirements Index](./prd.md#platform-requirements-index) for definitions.

  adr_reference:
    example: |
      This implements the Tri-State Memory Architecture defined in
      [ADR-006](./architecture.md#adr-006-tri-state-memory-architecture).

  interface_reference:
    example: |
      Uses the `SystemEvent` interface defined in
      [ADR-002](./architecture.md#adr-002-event-envelope--schema).

  ux_reference:
    example: |
      Visual specifications in [UX Design Â§Chronicle View](./ux-design.md#22-chronicle-view-default).

# =============================================================================
# VALIDATION RULES
# =============================================================================
#
# These rules can be enforced by CI/validation scripts.

validation_rules:
  - name: "No TypeScript in PRD"
    pattern: "interface.*\\{"
    forbidden_in: ["prd.md"]
    message: "TypeScript interfaces belong in architecture.md"

  - name: "No requirement definitions in Epics"
    pattern: "^### (PR|IC)-\\d{3}"
    forbidden_in: ["epics.md"]
    message: "Requirement definitions belong in prd.md; reference by ID only"

  - name: "No hex colors outside UX Design"
    pattern: "#[0-9a-fA-F]{6}"
    forbidden_in: ["prd.md", "architecture.md", "epics.md"]
    message: "Color specifications belong in ux-design.md"

  - name: "No visual specs in Architecture"
    pattern: "(px|rem|font-size|line-height)"
    forbidden_in: ["architecture.md"]
    allowed_context: ["code blocks for CSS variables only"]
    message: "Visual specifications belong in ux-design.md"
